let parser=new DOMParser;function appendHtmlToNode(e,t,n=!0){t=parser.parseFromString(t,"text/html");if(n)for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t.documentElement)}function bytesToBase64(e){e=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(e)}function findNameFromTags(t){for(let e=0;e<t.length;e++)if("Name"===t[e].Key)return t[e].Value;return""}let getMyIp=async()=>{var e=await(await fetch("https://api.ipify.org/?format=json")).json();return e.hasOwnProperty("ip")&&e.ip.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)?e.ip:""};function openConsole(e){window.openInBrowser(e)}function setValueInNamespace(e,t,n){localStorage.setItem(e+"-"+t,n)}function getValueInNamespace(e,t){return localStorage.getItem(e+"-"+t)||""}function convertRegionCodeToName(e){var t={"us-east-1":"US: N. Virginia","us-east-2":"US: Ohio","us-west-1":"US: N. California","us-west-2":"US: Oregon","ap-southeast-4":"AU: Melbourne","ap-south-1":"IN: Mumbai","ap-northeast-3":"JP: Osaka","ap-northeast-2":"KR: Seoul","ap-southeast-1":"SG: Singapore","ap-southeast-2":"AU: Sydney","ap-northeast-1":"JP: Tokyo","ca-central-1":"CA: Central Canada","eu-central-1":"DE: Frankfurt","eu-west-1":"IE: Ireland","eu-west-2":"GB: London","eu-west-3":"FR: Paris","eu-north-1":"SE: Stockholm","sa-east-1":"BR: São Paulo","af-south-1":"SA: Cape Town","ap-east-1":"CN: Hong Kong","ap-south-2":"IN: Hyderabad","ap-southeast-3":"ID: Jakarta","ca-west-1":"CA: Calgary","eu-central-2":"CH: Zurich","eu-south-1":"IT: Milan","eu-south-2":"ES: Spain","il-central-1":"IL: Tel Aviv","me-central-1":"AE: UAE","me-south-1":"BH: Bahrain"};return t.hasOwnProperty(e)?t[e]:e}let taskQueue=[],TASK_TYPES={KIT_DEPLOYMENT:"kit-deployment",REGIONAL_PIPELINE_BUILD:"regional-pipeline-build",REGIONAL_DATA_LOADING:"regional-data-load",CREATE_KEY:"create-key-pair",OTHER:"other"},TASK_STATES={WAITING:"waiting",STARTED:"started",IN_PROGRESS:"in-progress",COMPLETE:"complete",FAILED:"failed",FAILED_NEEDS_DELETION:"failed-needs-deletion",DELETED:"deleted",DELETE_FAILED:"delete-failed"},TASK_EVENTS={LOADING_COMPLETE:"LOADING_COMPLETE",KEY_READY:"KEY_READY",DEPLOYMENT_COMPLETE:"DEPLOYMENT_COMPLETE",DEPLOYMENT_FAILED:"DEPLOYMENT_FAILED"};class Task{constructor(e,t){this.type=e,this.name=t,this.state=TASK_STATES.WAITING,this.lastCheck=null}}function evaluateStatus(e){return e.match(/(ATE_COMPLETE|UPDATE_ROLLBACK_COMPLETE|Succeeded)$/)?TASK_STATES.COMPLETE:e.match(/^(CREATE_FAILED|ROLLBACK_COMPLETE|ROLLBACK_FAILED|UPDATE_ROLLBACK_FAILED|Failed)/)?TASK_STATES.FAILED_NEEDS_DELETION:e.match(/DELETE_FAILED/)?TASK_STATES.FAILED:e.match(/DELETE_COMPLETE/)?TASK_STATES.DELETED:e.match(/(_IN_PROGRESS|InProgress)/)?TASK_STATES.IN_PROGRESS:TASK_STATES.FAILED}function addToTaskQueue(n){if(n instanceof Task){let t=!1;for(let e=0;e<taskQueue.length;e++)if(taskQueue[e].type===n.type&&taskQueue[e].name===n.name){t=!0;break}t||taskQueue.push(n)}}function checkTasks(t){if(0<taskQueue.length){for(let e=0;e<taskQueue.length;e++)switch(taskQueue[e].type){case TASK_TYPES.KIT_DEPLOYMENT:t.type===TASK_EVENTS.DEPLOYMENT_COMPLETE&&checkStackComplete(t.detail,taskQueue,e);break;case TASK_TYPES.REGIONAL_PIPELINE_BUILD:t.type===TASK_EVENTS.DEPLOYMENT_COMPLETE?checkStackComplete("csk-cdk-app-delivery-pipeline-stack",taskQueue,e):t.type===TASK_EVENTS.DEPLOYMENT_FAILED&&(taskQueue[e].state=TASK_STATES.FAILED);break;case TASK_TYPES.REGIONAL_DATA_LOADING:t.type===TASK_EVENTS.LOADING_COMPLETE?taskQueue[e].state=TASK_STATES.COMPLETE:(taskQueue[e].state=TASK_STATES.IN_PROGRESS,taskQueue[e].lastCheck=new Date);break;case TASK_TYPES.CREATE_KEY:t.type===TASK_EVENTS.KEY_READY?taskQueue[e].state=TASK_STATES.COMPLETE:(taskQueue[e].state=TASK_STATES.IN_PROGRESS,taskQueue[e].lastCheck=new Date)}removeCompletedTasks()}}function checkTasksFromStackList(){for(let e=0;e<taskQueue.length;e++)taskQueue[e].type===TASK_TYPES.KIT_DEPLOYMENT?checkStackComplete(taskQueue[e].name,taskQueue,e+0):taskQueue[e].type===TASK_TYPES.REGIONAL_PIPELINE_BUILD&&checkStackComplete("csk-cdk-app-delivery-pipeline-stack",taskQueue,e+0)}function checkStackComplete(e,n,t){let a=t;window.getStackStatus(e,function(e,t){a,e?e.message.match("does not exist")?(n[a].state=TASK_STATES.WAITING,n[a].lastCheck=new Date):n[a].state=TASK_STATES.FAILED:(n[a].state=evaluateStatus(t.Stacks[0].StackStatus),n[a].lastCheck=new Date,n[a].state===TASK_STATES.COMPLETE&&0<t.Stacks[0].Outputs.length&&"CskSourceBucketName"===t.Stacks[0].Outputs[0].ExportName&&setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[0].OutputValue))})}function removeCompletedTasks(){var t=[];for(let e=0;e<taskQueue.length;e++)taskQueue[e].state===TASK_STATES.COMPLETE||taskQueue[e].state===TASK_STATES.DELETED||taskQueue[e].state===TASK_STATES.FAILED?TASK_TYPES.KIT_DEPLOYMENT===taskQueue[e].type&&reenableKitButton(taskQueue[e].name):taskQueue[e].state===TASK_STATES.FAILED_NEEDS_DELETION?TASK_TYPES.KIT_DEPLOYMENT===taskQueue[e].type&&(reenableKitButton(taskQueue[e].name),showDeleteKitButton(taskQueue[e].name)):t.push(taskQueue[e]);taskQueue=t}function regionControlsCanBeUnlocked(){if(0!==taskQueue.length)for(let e=0;e<taskQueue.length;e++){if(taskQueue[e].type===TASK_TYPES.REGIONAL_DATA_LOADING&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1;if(taskQueue[e].type===TASK_TYPES.REGIONAL_PIPELINE_BUILD&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1;if(taskQueue[e].type===TASK_TYPES.KIT_DEPLOYMENT&&taskQueue[e].state!==TASK_STATES.COMPLETE)return!1}return!0}function showTaskQueueLength(){0<taskQueue.length?lockRegionControls(!0):lockRegionControls(!1),document.getElementById("tasks-display").innerText=`${0<taskQueue.length?taskQueue.length:"No"} task${1<taskQueue.length?"s":""} running`}Object.defineProperty(Task,"TYPES",{value:TASK_TYPES,writable:!1}),Object.defineProperty(Task,"STATES",{value:TASK_STATES,writable:!1}),Object.defineProperty(Task,"EVENTS",{value:TASK_EVENTS,writable:!1}),addEventListener("LOADING_COMPLETE",checkTasks),addEventListener("KEY_READY",checkTasks),addEventListener("DEPLOYMENT_COMPLETE",checkTasks),addEventListener("DEPLOYMENT_FAILED",checkTasks),setInterval(checkTasksFromStackList,5e3),setInterval(removeCompletedTasks,5e3),setInterval(showTaskQueueLength,1e3);let bouncyBox='<span class="la-square-jelly-box la-dark la-sm" style="margin-left: 3px; margin-right: 10px; margin-bottom: -1px; display: inline-block; color: black; height: 12px; width: 12px;"><div></div><div></div></span>',preMonitoringDelay=1,monitoringTimeout=1800,cfMonitor=null,stackStates={},lastReportedStates={},stackEvents={},stackInfoRequestors={},stackOutputs={},debugMessages={},mostRecentEventTime=null,allStacks={};function listAllStacks(){window.listStacks((e,t)=>{if(!e){allStacks={};for(let e=0;e<t.Stacks.length;e++)allStacks[t.Stacks[e].StackId]=t.Stacks[e];var n,e=document.getElementById("deployed-stacks"),a=(e.innerText="",document.createElement("div")),s=(a.classList.add("scrollable"),document.createElement("h1")),o=(s.classList=["installed-kits-heading"],s.innerText="Installed Kits",document.createElement("p"));for(n in o.innerText="This is a listing of the kits that have been deployed as CloudFormation stacks into this account.",a.appendChild(s),a.appendChild(o),allStacks)if(!(allStacks[n].StackName.match(/sendStatisticsStack/)||allStacks[n].hasOwnProperty("RootId")&&allStacks[n].RootId.match(/\w/))){var i=allStacks[n].Tags,r={};for(let e=0;e<i.length;e++)r[i[e].Key]=i[e].Value;if(r.hasOwnProperty("KitId")||"CDKToolkit"===allStacks[n].StackName){let e=allStacks[n].StackName;var l=getFromKitMetadata(r.KitId),l=(l&&(e=l.Name),document.createElement("h5")),d=(l.classList.add("sub-heading"),l.innerText=e,document.createElement("p")),c=(appendHtmlToNode(d,"<b>Status:</b> "+labelStatus(allStacks[n].StackStatus)),document.createElement("p")),u=(c.innerText=allStacks[n].Description||"No description available",document.createElement("p")),m=document.createElement("a"),p=(m.innerText="⬆️ Inputs",m.classList=["stack-info"],m.setAttribute("onclick",`showInputs("${allStacks[n].StackId}")`),document.createElement("a")),g=(p.innerText="⬇️ Outputs",p.classList=["stack-info"],p.setAttribute("onclick",`showOutputs("${allStacks[n].StackId}")`),document.createElement("a")),E=(g.innerText="👀 View in Console",g.classList=["stack-info"],g.setAttribute("onclick",`goToConsole("${allStacks[n].StackId}")`),document.createElement("div"));E.id=allStacks[n].StackId+"-metadata",E.classList.add("deployed-kit-metadata"),u.appendChild(m),u.appendChild(p),evaluateStatus(allStacks[n].StackStatus)===TASK_STATES.FAILED_NEEDS_DELETION&&((m=document.createElement("a")).innerText="🗑️ Delete",m.classList=["stack-info"],m.setAttribute("onclick",`confirmDeleteStack("${allStacks[n].StackId}")`),u.appendChild(m)),u.appendChild(g),a.appendChild(l),a.appendChild(d),a.appendChild(c),a.appendChild(u),a.appendChild(E)}}e.appendChild(a)}})}function confirmDeleteStack(e){confirm(`Are you sure you want to delete stack ${e}?`)&&window.deleteStack(e,(e,t)=>{})}function getFromKitMetadata(e){return kitMetadata.hasOwnProperty(e)?kitMetadata[e]:null}function showInputs(e){var t=allStacks[e],n=t.Parameters,a=[];for(let e=0;e<n.length;e++)"BootstrapVersion"!==n[e].ParameterKey&&a.push(n[e]);var t=localStorage.getItem(`${account}-${region}-`+t.StackName),s=t&&t.match(/^\[/)?JSON.parse(t):[],o=document.createElement("div");if(0===a.length&&0===s.length){t=document.createElement("div");t.innerText="Stack had no inputs.",o.appendChild(t)}else{for(let e=0;e<a.length;e++){var i=document.createElement("div");appendHtmlToNode(i,`<b>${a[e].ParameterKey}</b>: `+a[e].ParameterValue),o.appendChild(i)}for(let e=0;e<s.length;e++){var r=document.createElement("div");appendHtmlToNode(r,`<b>${s[e].ParameterKey}</b>: `+s[e].ParameterValue),o.appendChild(r)}}t=document.getElementById(e+"-metadata");t.innerText="",t.appendChild(o)}function showOutputs(e){var t=allStacks[e].Outputs,n=document.createElement("div");if(0===t.length){var a=document.createElement("div");a.innerText="Stack had no outputs.",n.appendChild(a)}else for(let e=0;e<t.length;e++){var s=document.createElement("div");appendHtmlToNode(s,`<b>${t[e].OutputKey}</b>: `+t[e].OutputValue),n.appendChild(s)}a=document.getElementById(e+"-metadata");a.innerText="",a.appendChild(n)}function goToConsole(e){openConsole(`https://${region}.console.aws.amazon.com/cloudformation/home?region=${region}#/stacks/stackinfo?stackId=`+e)}function resetStackMonitoring(){cfMonitor=null,stackStates={},lastReportedStates={},stackEvents={},stackInfoRequestors={},stackOutputs={},debugMessages={},mostRecentEventTime=null}function showStacksProgressFunc(){if(window.loggedIn){var e=window.getStacksInProgress();if(0<Object.keys(e).length)for(var t in e)e[t].tracking&&window.getStackEvents(t,stackEventsResponseHandler)}}let stackEventsResponseHandler=function(e,n,a){var s=window.getStacksInProgress();if(n&&n.hasOwnProperty("Timestamp")){let t=new Date(n.Timestamp).getTime();mostRecentEventTime=mostRecentEventTime||t,t>mostRecentEventTime&&(mostRecentEventTime=t);for(let e=0;e<a.length;e++)(t=new Date(a[e].Timestamp).getTime())>mostRecentEventTime&&(mostRecentEventTime=t);stackStates.hasOwnProperty(e)||(stackStates[e]={}),(stackStates[e]=n)&&n.hasOwnProperty("ResourceStatus")&&(s[e].status=n.ResourceStatus,evaluateStatus(n.ResourceStatus)===TASK_STATES.COMPLETE)&&s[e].hasOutputs&&!stackInfoRequestors.hasOwnProperty(e)&&(stackInfoRequestors[e]=setInterval(requestStackInfo,3e3,e)),0<Object.keys(a).length?stackEvents[e]=a:stackEvents[e]={},updateStackEventDisplay(s)}else{let n=s[e].kitId;window.getStackInfo(e,(e,t)=>{t&&t.toString().match("does not exist")||t&&t.hasOwnProperty("Stacks")&&evaluateStatus(t.Stacks[0].StackStatus)===TASK_STATES.COMPLETE&&(window.handleCompletedStack(e),unlockInstallButton(n),registerProgress(n,100,n+" has already been installed."),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:t.Stacks[0].StackName})),stopMonitoring())})}},eventOutput={},previousEventOutput={},updateStackEventDisplay=function(a){let s=Object.keys(a).length;for(var e in stackStates){var t=a[e].kitId;eventOutput.hasOwnProperty(t)||(eventOutput[t]={}),eventOutput[t][e]="",previousEventOutput[t]=document.getElementById(t+"-cf-stack-states").innerHTML}for(var o in stackStates){var i=a[o].kitId,r=document.getElementById("region-select").value,l=` <a onclick="openConsole('https://${r}.console.aws.amazon.com/cloudformation/home?region=${r}#/stacks/stackinfo?stackId=${stackStates[o].StackId}')">View in Console</a><br>`;0===Object.keys(stackStates).length&&(eventOutput[i][o]+=bouncyBox);let e=50,t=Number(a[o].resourceCount);var d=Object.keys(stackEvents[o]).length;0<(t=d>t?d:t)&&-1<d&&(e=d/t*100),eventOutput[i][o]+="<b>"+o+"</b>: ",lastReportedStates[o]!==stackStates[o].ResourceStatus?(phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:i,stack_status:stackStates[o].ResourceStatus,stack_name:o,details:stackStates[o]}),eventOutput[i][o]+=labelStatus(stackStates[o].ResourceStatus),eventOutput[i][o]+=l,evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.COMPLETE?(registerProgress(i,100),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:o})),dispatchEvent(new Event("POST_STACK_UPDATE")),window.handleCompletedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED?(registerProgress(i,1),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED_NEEDS_DELETION?(registerProgress(i,100),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.DELETED?(registerProgress(i,1),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:o})),window.handleFailedStack(o),unlockInstallButton(i),s=--s):(registerProgress(i,e),window.keepWatchingStack(o)),lastReportedStates[o]=stackStates[o].ResourceStatus):(evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.COMPLETE||evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.DELETED?(s=--s,registerProgress(i,100)):evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED||evaluateStatus(stackStates[o].ResourceStatus)===TASK_STATES.FAILED_NEEDS_DELETION?(s=--s,registerProgress(i,1)):registerProgress(i,e),eventOutput[i][o]+=labelStatus(stackStates[o].ResourceStatus),eventOutput[i][o]+=l);let n="";var c=`<a onclick="openConsole('https://${r}.console.aws.amazon.com/cloudformation/home?region=${r}#/stacks/resources?stackId=${stackStates[o].StackId}')">`;if(0<Object.keys(stackEvents[o]).length)for(var u in stackEvents[o]){var m=u.replace(o.replace(/-stack/,"").replace(/-/g,""),"");n+=`├─ <b>${stackEvents[o][u].ResourceType}</b> ${c}<div class="inline-truncated">${m}</div></a> ${labelStatus(stackEvents[o][u].ResourceStatus)}<br>`,stackEvents[o][u].ResourceType}else n+="├─ No resources found";eventOutput[i][o]+=n}var n,p,g={};for(n in stackStates){var E=a[n].kitId;g.hasOwnProperty(E)||(g[E]=""),g[E]+=eventOutput[E][n]}for(p in g)previousEventOutput[p]!==g[p]&&appendHtmlToNode(document.getElementById(p+"-cf-stack-states"),g[p]);s<=0&&(s=0)};function unlockInstallButton(e){document.getElementById(e+"-install-button").disabled=!1}let requestStackInfo=function(e){window.getStackInfo(e,outputsResponseHandler)},outputsResponseHandler=function(e,t){t.hasOwnProperty("Stacks")&&0<t.Stacks[0].Outputs.length&&(clearInterval(stackInfoRequestors[t.Stacks[0].StackName]),stackOutputs[t.Stacks[0].StackName]=t.Stacks[0].Outputs,showCfnOutputs(t.Stacks[0].StackName))},htmlCfnOutputs={},showCfnOutputs=function(e){var t,n=window.getStacksInProgress()[e].kitId,e=document.getElementById(n+"-cf-stack-outputs");for(t in stackOutputs){htmlCfnOutputs.hasOwnProperty(n)||(htmlCfnOutputs[n]=""),htmlCfnOutputs[n]+="<b>"+t+":</b><br/>";for(let e=0;e<stackOutputs[t].length;e++)htmlCfnOutputs[n]+="<b>"+stackOutputs[t][e].OutputKey+"</b>: "+stackOutputs[t][e].OutputValue+"<br>"}appendHtmlToNode(e,htmlCfnOutputs[n])},deployResponseHandler=function(e,t,n){var a,s=window.getStacksInProgress();e&&(e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)&&(n=e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)[1]),stopMonitoring(),registerProgress(s[n].kitId,1,e.toString()));let o=setInterval(()=>{regionControlsCanBeUnlocked()&&(lockRegionControls(!1),clearInterval(o))},3e3);n=n||(t&&t.hasOwnProperty("StackId")?t.StackId.split("/")[1]:e&&e.hasOwnProperty("StackId")?e.StackId.split("/")[1]:e&&e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)?e.toString().match(/Stack \[([A-Za-z0-9-]+)\] already exists/)[1]:"Unknown"),e&&"Unknown"!==n?((e="object"==typeof e?e.toString():e).match(/credentials/i)?(displayCredentialErrors(!0,e),resetUi()):(debugMessages[n]=e,phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:s[n].kitId,stack_status:"failed",stack_name:n,details:e})),registerProgress(s[n].kitId,1,e),window.handleFailedStack(n)):e&&"Unknown"===n||t&&(debugMessages[n]=t,addToTaskQueue(new Task(Task.TYPES.KIT_DEPLOYMENT,n)),lockRegionControls(!0),t.hasOwnProperty("Location")?(registerProgress(s[n].kitId,1,"Kit uploaded successfully, starting deployment pipeline..."),debugMessages[n]=`Deploying via pipeline: <a onclick="openConsole('https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines')">View in Console</a>`):t.hasOwnProperty("pipelineExecutionId")?(registerProgress(s[n].kitId,1,"Kit uploaded successfully, starting pipeline...please wait"),e=getValueInNamespace(account+"-"+region,"PipelineName"),a=`https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines/${e}/executions/${t.pipelineExecutionId}/visualization?region=`+region,debugMessages[n]=`Deploying via pipeline: <a onclick="openConsole('${a}')">View in Console</a>`,monitorPipeline(s[n].kitId,n,t.pipelineExecutionId,e)):t.hasOwnProperty("noOp")&&!0===t.noOp&&(phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:s[n].kitId,stack_status:"success",stack_name:n,details:t}),registerProgress(s[n].kitId,100,n+" already deployed"),window.handleCompletedStack(n)));var i,r,l={};for(i in debugMessages){var d=s[i].kitId;l.hasOwnProperty(d)||(l[d]={})}for(r in debugMessages){var c=s[r].kitId;l[c][r]="","object"==typeof debugMessages[r]?l[c][r]+=`<b>${r}</b>: `+JSON.stringify(debugMessages[r],null,4)+"<br>":l[c][r]+=t?`<b>${r}</b>:  <span class="success">`+debugMessages[r]+"</span><br>":`<b>${r}</b>:  <span class="error">`+debugMessages[r]+"</span><br>"}var u,m={};for(u in l){for(var p in m[u]="",l[u])m[u]+=l[u][p];appendHtmlToNode(document.getElementById(u+"-deploystack-output"),m[u])}};function monitorPipeline(a,s,o,i){let r=setInterval(()=>{window.getPipelineStatus(o,(e,t)=>{var n;t.hasOwnProperty("pipelineExecution")&&t.pipelineExecution.hasOwnProperty("status")&&(n=`https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines/${i}/executions/${o}/visualization?region=`+region,n=`<span class="success"><b>Pipeline Status:</b> ${labelStatus(t.pipelineExecution.status).replace(/([a-z0-9])([A-Z])/g,"$1 $2")}&nbsp;&nbsp;&nbsp;<a onclick="openConsole('${n}')">View in Console</a></span><br>`,appendHtmlToNode(document.getElementById(a+"-deploystack-output"),n),"Succeeded"===t.pipelineExecution.status?(clearInterval(r),registerProgress(a,100,s+" deployed successfully"),window.handleCompletedStack(s)):"Failed"===t.pipelineExecution.status?(clearInterval(r),registerProgress(a,1,`Failed to deploy ${s} - check the console for more information`),window.handleFailedStack(s)):updateProgressBarMessage(a,s+" deployment: "+t.pipelineExecution.status.replace(/([a-z0-9])([A-Z])/g,"$1 $2")))})},5e3)}function resetAllKitMonitors(){for(var e in kitMetadata)try{registerProgress(e,1),appendHtmlToNode(document.getElementById(e+"-deploystack-output"),""),appendHtmlToNode(document.getElementById(e+"-cf-stack-states"),""),appendHtmlToNode(document.getElementById(e+"-cf-stack-outputs"),""),document.getElementById(e+"-install-button").disabled=!1,document.getElementById(e+"-deployment-progress").style.display="none",document.getElementById(e+"-deployment-details").style.display="none",hideConfigForKit(e)}catch(e){}}function registerProgress(e,t,n=""){progressBars[e][1].style.width=Math.floor(t)+"%",progressBars[e][0].textContent=Math.floor(t)+"%",1===t||100===t?(n&&updateProgressBarMessage(e,n),progressBars[e][1].style["animation-play-state"]="paused",progressBars[e][0].textContent=""):progressBars[e][1].style["animation-play-state"]="running"}function updateProgressBarMessage(e,t){t&&(progressBars[e][2].textContent=t)}function startMonitoring(){setTimeout(()=>{cfMonitor=setInterval(showStacksProgressFunc,3e3)},1e3*preMonitoringDelay),setTimeout(monitoringChecker,1e3*monitoringTimeout)}function stopMonitoring(){clearInterval(cfMonitor)}function monitoringChecker(){(new Date).getTime()-mostRecentEventTime>1e3*monitoringTimeout?(displayErrors(`Monitoring timeout reached - ${monitoringTimeout}s has passed with no new events. Check the status of your stacks in the CloudFormation console.`),stopMonitoring()):setTimeout(monitoringChecker,3e3)}function clearStackMonitor(e){window.clearTrackedStacks(e)}function clearStackMonitors(){window.clearTrackedStacks()}function labelStatus(e){let t="";return t=evaluateStatus(e)===TASK_STATES.COMPLETE?e+"  ✅":evaluateStatus(e)===TASK_STATES.FAILED||evaluateStatus(e)===TASK_STATES.FAILED_NEEDS_DELETION||evaluateStatus(e)===TASK_STATES.DELETED||evaluateStatus(e)===TASK_STATES.DELETE_FAILED?e+"  ❌":e+"  "+bouncyBox}let excludedAttributes=["id","name","value","type","value","style","class","min","max","required","pattern","onchange"];function getFormInputs(n){var e,a=[],s=templateParameters.hasOwnProperty(n)?templateParameters[n]:[],o={};for(let t=0;t<s.length;t++){var i=n+"|"+s[t],i=document.getElementById(i);let e=i.value;if(i.tagName.match(/^textarea$/i)&&(e=bytesToBase64((new TextEncoder).encode(e))),i.tagName.match(/^input$/i)&&"checkbox"===i.getAttribute("type")&&(e=i.checked),i.tagName.match(/^select$/i)&&-1<i.selectedIndex){var r=i.options[i.selectedIndex];if(r.hasAttributes())for(var l of r.attributes)excludedAttributes.indexOf(l.name)<0&&(o[s[t]+"-"+l.name]=l.value)}if(i.hasAttributes())for(var d of i.attributes)excludedAttributes.indexOf(d.name)<0&&(o[s[t]+"-"+d.name]=d.value);r={ParameterKey:s[t],ParameterValue:e,ResolvedValue:String(e).match("^/")?e:null,UsePreviousValue:!1};a.push(r)}for(e in o){var t={ParameterKey:e,ParameterValue:o[e],ResolvedValue:o[e],UsePreviousValue:!1};a.push(t)}return a}async function deployCfnTemplate(a,e=0){if(window.loggedIn){var t=kitMetadata[a],s=t.Templates,o=getFormInputs(a);for(let n=0;n<s.length;n++){var i=[],r=await window.getFileFromBucket("kits/cfn-templates/"+s[n]);if(r.hasOwnProperty("Parameters"))for(var l in r.Parameters)for(let e=0;e<o.length;e++)o[e].ParameterKey===l&&i.push(o[e]);var d=t.hasOwnProperty("stackNamingParam")?t.stackNamingParam:null,d=window.deriveStackName(s[n],i,d);if(e===n){var c=getValueInNamespace(account+"-"+region,"SourceBucket");51999<JSON.stringify(r).length?""!==c&&(startMonitoring(),phoneHome({action:"deploy-cfn-kit",kit_id:a,starter_kit:s[n],details:i}),window.deployCloudFormationTemplate(a,s[n],d,i,c,deployResponseHandler)):(startMonitoring(),phoneHome({action:"deploy-cfn-kit",kit_id:a,starter_kit:s[n],details:i}),window.deployCloudFormationTemplate(a,s[n],d,i,null,deployResponseHandler))}else if(0<n&&n>e){let t=window.deriveStackName(s[n-1],i);addEventListener(TASK_EVENTS.DEPLOYMENT_COMPLETE,e=>{e.detail===t&&deployCfnTemplate(a,n)})}}}}function deployCdkApp(e){var t,n,a;window.loggedIn&&(t=kitMetadata[e],n=getFormInputs(e),[].push(t.Manifest),""===(a=getValueInNamespace(account+"-"+region,"SourceBucket"))&&alert("No source bucket available"),startMonitoring(),phoneHome({csk_id:window.resellerConfig.csk_id,kit_id:e,action:"deploy-cdk-kit",partner_name:window.resellerConfig.AWSDistributorName,country_code:window.resellerConfig.CountryCode,starter_kit:t.Manifest,details:n}),window.deployCdkViaSourceBucket(e,t.Manifest,n,region,account,a,deployResponseHandler))}function destroyStack(i){window.loggedIn&&window.listStacks((e,t)=>{if(!e){allStacks={};for(let e=0;e<t.Stacks.length;e++)allStacks[t.Stacks[e].StackId]=t.Stacks[e];for(var n in allStacks)if(evaluateStatus(allStacks[n].StackStatus)===TASK_STATES.FAILED_NEEDS_DELETION){var a,s=allStacks[n].Tags,o={};for(let e=0;e<s.length;e++)o[s[e].Key]=s[e].Value;o.hasOwnProperty("KitId")&&(a=getFromKitMetadata(o.KitId))&&a.name===i&&window.deleteStack(allStacks[n].StackName,(e,t)=>{})}}})}function fetchAmis(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"amiDataLastFetch"));if(t&&60<e-t&&e-86400<t){t=getValueInNamespace(region,"amiData");if(""!==t)return window.amis=JSON.parse(t),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"amiDataLastFetch",e),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*arm64-server*"]},{Name:"description",Values:["Canonical, Ubuntu*LTS*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]},{Name:"owner-id",Values:["099720109477"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(!n.Images[t].Name.match("daily")&&!n.Images[t].Name.match("eks")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{8}(\.\d)*/,"");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var r,l=[];for(r in t)l.push(t[r]);window.amis.ubuntuArm=l,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*server*"]},{Name:"description",Values:["Canonical, Ubuntu*LTS*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]},{Name:"owner-id",Values:["099720109477"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(!n.Images[t].Name.match("daily")&&!n.Images[t].Name.match("eks")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{8}(\.\d)*/,"");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var r,l=[];for(r in t)l.push(t[r]);window.amis.ubuntu=l,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"platform",Values:["windows"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,n)=>{if(!e){var a=[],s={};for(let t=0;t<n.Images.length;t++)if(n.Images[t].Name.match("English")&&!n.Images[t].Name.match("EKS")&&!n.Images[t].Name.match("ECS")){let e=n.Images[t].Name.split("/").pop();e=e.split("-").pop()+("-"+e),a.push(e),s[e]=n.Images[t]}a.sort().reverse();var t={};for(let e=0;e<a.length;e++){var o=s[a[e]],i=o.Name.replace(/-\d{4}\.\d{2}\.\d{2}/,"");t.hasOwnProperty(i)||(t[o.ShortName=i]=o)}var r,l=[];for(r in t)l.push(t[r]);window.amis.windows=l,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*al2023*"]},{Name:"description",Values:["Amazon Linux*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],r=i.Name.replace(/-\d{4}\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(r)||(o[i.ShortName=r]=i)}var l,d=[];for(l in o)d.push(o[l]);window.amis.linux2023=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*al2023*"]},{Name:"description",Values:["Amazon Linux*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],r=i.Name.replace(/-\d{4}\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(r)||(o[i.ShortName=r]=i)}var l,d=[];for(l in o)d.push(o[l]);window.amis.linux2023Arm=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*amzn2*"]},{Name:"description",Values:["Amazon Linux 2*"]},{Name:"architecture",Values:["x86_64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],r=i.Name.replace(/-\d\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(r)||(o[i.ShortName=r]=i)}var l,d=[];for(l in o)d.push(o[l]);window.amis.linux2=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}}),window.describeAmis({Filters:[{Name:"owner-alias",Values:["amazon"]},{Name:"name",Values:["*amzn2*"]},{Name:"description",Values:["Amazon Linux 2*"]},{Name:"architecture",Values:["arm64"]},{Name:"virtualization-type",Values:["hvm"]},{Name:"state",Values:["available"]},{Name:"image-type",Values:["machine"]},{Name:"root-device-type",Values:["ebs"]},{Name:"hypervisor",Values:["xen","nitro"]}]},(e,t)=>{if(!e){var n,a=[],s={};for(let e=0;e<t.Images.length;e++)t.Images[e].Name.match("ecs")||(n=t.Images[e].Name,n=t.Images[e].CreationDate+"-"+n,a.push(n),s[n]=t.Images[e]);a.sort().reverse();var o={};for(let e=0;e<a.length;e++){var i=s[a[e]],r=i.Name.replace(/-\d\.\d\.\d{8}(\.\d)*/,"");o.hasOwnProperty(r)||(o[i.ShortName=r]=i)}var l,d=[];for(l in o)d.push(o[l]);window.amis.linuxArm=d,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("AMI_DATA_UPDATE"))}})}function cacheAmiData(){setValueInNamespace(region,"amiData",JSON.stringify(window.amis))}window.amis={},window.amis.windows=[],window.amis.linux2=[],window.amis.linuxArm=[],window.amis.ubuntu=[],window.amis.ubuntuArm=[],window.amis.linux2023=[],window.amis.linux2023Arm=[],addEventListener("AMI_DATA_UPDATE",cacheAmiData),window.instanceTypes={};let instanceTypeNames=[];function resetAmiInstanceTypeLists(){instanceTypeNames=[],window.instanceTypes={},window.amis={},window.amis.windows=[],window.amis.linux2=[],window.amis.linuxArm=[],window.amis.ubuntu=[],window.amis.ubuntuArm=[],window.amis.linux2023=[],window.amis.linux2023Arm=[]}function getInstanceTypes(e){var t=Math.round((new Date).getTime()/1e3),n=Number(getValueInNamespace(region,"instanceDataLastFetch"));if(!e&&n&&60<t-n&&t-86400<n){n=getValueInNamespace(region,"instanceData");if(""!==n)return window.instanceTypes=JSON.parse(n),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"instanceDataLastFetch",t);n={Filters:[{Name:"instance-type",Values:["*"]},{Name:"bare-metal",Values:["false"]},{Name:"current-generation",Values:["true"]},{Name:"supported-virtualization-type",Values:["hvm"]}]};e&&(n.NextToken=e),window.describeInstanceTypes(n,(e,t)=>{if(!e){for(let e=0;e<t.InstanceTypes.length;e++){var n;!t.InstanceTypes[e].InstanceType.match(/(flex|u-|hpc)/)&&t.InstanceTypes[e].InstanceType.match(/^[a-z][\d\w]{1,5}\./)&&(n=t.InstanceTypes[e].InstanceType.split(".")[0],n=(n+=String(t.InstanceTypes[e].VCpuInfo.DefaultVCpus).padStart(3,"0"))+String(t.InstanceTypes[e].MemoryInfo.SizeInMiB).padStart(4,"0"),instanceTypeNames.push(n+"-"+t.InstanceTypes[e].InstanceType),window.instanceTypes[t.InstanceTypes[e].InstanceType]=t.InstanceTypes[e])}instanceTypeNames.sort();var a={};for(let e=0;e<instanceTypeNames.length;e++){var s=instanceTypeNames[e].split("-")[1];a[s]=window.instanceTypes[s]}t.NextToken?(dispatchEvent(new Event("EXTEND_LOAD_DELAY")),getInstanceTypes(t.NextToken)):(window.instanceTypes=a,dispatchEvent(new Event("UI_DATA_UPDATE")),dispatchEvent(new Event("INSTANCE_DATA_UPDATE")))}})}function cacheInstanceData(){setValueInNamespace(region,"instanceData",JSON.stringify(window.instanceTypes))}function resetDbInfraLists(){window.dbEngines={},window.serverlessDbEngines={},window.dbInstances={}}function getAllDbEngines(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"dbEngineLastFetch"));if(t&&60<e-t&&e-86400<t){var t=getValueInNamespace(region,"dbEngines"),n=getValueInNamespace(region,"serverlessDbEngines");if(""!==t)return window.dbEngines=JSON.parse(t),window.serverlessDbEngines=JSON.parse(n),getAllDbInstances(),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"dbEngineLastFetch",e),window.describeDatabaseEngines({},(e,t)=>{if(t){for(var n in window.dbEngines=t,window.dbEngines)for(var a in window.dbEngines[n])window.dbEngines[n][a].hasOwnProperty("SupportedEngineModes")&&window.dbEngines[n][a].SupportedEngineModes.includes("serverless")&&(window.serverlessDbEngines.hasOwnProperty(n)||(window.serverlessDbEngines[n]={}),window.serverlessDbEngines[n].hasOwnProperty(a)||(window.serverlessDbEngines[n][a]={}),window.serverlessDbEngines[n][a]=window.dbEngines[n][a]);setValueInNamespace(region,"dbEngines",JSON.stringify(window.dbEngines)),setValueInNamespace(region,"serverlessDbEngines",JSON.stringify(window.serverlessDbEngines)),getAllDbInstances()}})}function getAllDbInstances(){var e=Math.round((new Date).getTime()/1e3),t=Number(getValueInNamespace(region,"dbInstancesLastFetch"));if(t&&60<e-t&&e-86400<t){t=getValueInNamespace(region,"dbInstances");if(""!==t)return window.dbInstances=JSON.parse(t),void dispatchEvent(new Event("UI_DATA_UPDATE"))}dispatchEvent(new Event("EXTEND_LOAD_DELAY")),setValueInNamespace(region,"dbInstancesLastFetch",e);for(let n in window.dbEngines)window.describeDatabaseInstances(n,(e,t)=>{t&&(window.dbInstances[n]=t[n],setValueInNamespace(region,"dbInstances",JSON.stringify(window.dbInstances)))})}function runSdkCommand(){document.getElementById("sdk-output").hidden=!1;try{switch(document.getElementById("sdk-commands-list").value){case"list-buckets":window.listBuckets(function(e,n){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{let t="";for(let e=0;e<n.Buckets.length;e++)t+="* "+n.Buckets[e].Name+"<br>\n";document.getElementById("sdk-result").innerText=preformatted(t,!1)}});break;case"list-subnets":window.getSubnets(function(e,n){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{let t="";for(let e=0;e<n.Subnets.length;e++)t+="* "+n.Subnets[e].SubnetId+" | "+n.Subnets[e].VpcId+" | "+n.Subnets[e].CidrBlock+" | "+n.Subnets[e].AvailabilityZone+"<br>\n";document.getElementById("sdk-result").innerText=preformatted(t,!1)}});break;case"get-credential-report":window.getCredentialReport(function(e,t){if(e)document.getElementById("sdk-result").innerText=preformatted(e,!0);else{var e=new TextDecoder("utf-8").decode(t.Content).replace(/[<>]/g,"").split("\n"),n=e[0].split(","),a=e[1].split(","),s={};for(let e=0;e<n.length;e++)s[n[e]]=a[e];document.getElementById("sdk-result").innerText=preformatted(s,!0)}});break;case"get-cloudfront-prefix-list":window.getPrefixLists({Filters:[{Name:"prefix-list-name",Values:["com.amazonaws.global.cloudfront.origin-facing"]}]},function(e,t){document.getElementById("sdk-result").innerText=preformatted(e||t,!0)})}}catch(e){document.getElementById("sdk-result").innerText=preformatted(e,!0)}}function preformatted(e,t){return t?(document.getElementById("sdk-result").classList.add("pre"),"[object Object]"===e.toString()?JSON.stringify(e,null,4):e):(document.getElementById("sdk-result").classList.remove("pre"),e)}addEventListener("INSTANCE_DATA_UPDATE",cacheInstanceData),window.dbEngines={},window.serverlessDbEngines={},window.dbInstances={},document.getElementById("execute-sdk-button").addEventListener("click",runSdkCommand);let region=null,account=null,progressBars={},templateParameters={},loadBlockTimeout=null,regionSelected=!1,kitMetadata={},defaultCategory=null,decoder=(document.documentElement.setAttribute("data-theme","light"),new TextDecoder);async function checkForKey(){var e=localStorage.getItem("kitConfig");e?(window.resellerConfig=JSON.parse(e),await fetchConfigForKey()):hideLoadingBlock()}function keyFound(){applyBranding(),document.getElementById("lock-block").hidden=!0,addEventListener("TEXT_LOADED",()=>{resetUi(),tryLogin(),toggleCredentialTypes(),hideLoadingBlock()}),setLanguage()}function reloadConfig(){var e=localStorage.getItem("kitConfig");e&&(window.resellerConfig=JSON.parse(e),fetchConfigForKey())}function purgeConfig(){localStorage.removeItem("kitConfig"),localStorage.removeItem("hosts"),window.api.restartApp()}async function fetchConfigForKey(){var e,t=document.getElementById("key").value||window.resellerConfig.csk_id;window.hasOwnProperty("hosts")||(window.hosts=JSON.parse(window.localStorage.getItem("hosts"))),t.match(/[a-zA-Z0-9]{22}/)&&(e=JSON.stringify({csk_id:t}),e=await(await fetch(`https://${window.hosts.CONFIG_HOST}/app/config/get`,{method:"POST",headers:{"Content-Type":"application/json","x-csk":t},body:e})).arrayBuffer(),(e=JSON.parse(decoder.decode(e))).hasOwnProperty("csk_id"))&&e.csk_id===t?(window.resellerConfig=e,window.resellerConfig.AWSDistributorName=e.BusinessName,window.resellerConfig.KitHubCode=""===e.KitHubCode?"none":e.KitHubCode,localStorage.setItem("kitConfig",JSON.stringify(window.resellerConfig)),dispatchEvent(new Event("KEY_FOUND")),phoneHome({action:`loaded config from key starting with ${t.substring(0,10)}...`})):document.getElementById("key-error").hidden=!1}function applyBranding(){window.hosts=JSON.parse(window.localStorage.getItem("hosts")),window.resellerConfig.distributor.hasOwnProperty("FileHost")&&window.resellerConfig.distributor.FileHost.match(/\w+\.\w+/)&&(window.hosts.FILE_HOST=window.resellerConfig.distributor.FileHost,window.setFileHost(window.hosts.FILE_HOST)),window.resellerConfig.hasOwnProperty("FileHost")&&window.resellerConfig.FileHost.match(/\w+\.\w+/)&&(window.hosts.FILE_HOST=window.resellerConfig.FileHost,window.setFileHost(window.hosts.FILE_HOST)),window.localStorage.setItem("hosts",JSON.stringify(window.hosts)),setTimeout(getAllKitsMetadata,1e3),document.getElementById("companyName").innerText=window.resellerConfig.BusinessName,document.title=window.resellerConfig.BusinessName+" | Cloud Starter Kit",document.getElementById("countryCode").innerText=window.resellerConfig.CountryCode,window.resellerConfig.hasOwnProperty("distributor")&&window.resellerConfig.distributor.hasOwnProperty("LogoUrl")&&(document.getElementById("menu-distie-logo").setAttribute("src",window.resellerConfig.distributor.LogoUrl),document.getElementById("menu-distie-logo").style=window.resellerConfig.distributor.LogoCss,document.title=`${window.resellerConfig.distributor.BusinessName} | ${window.resellerConfig.BusinessName} | Cloud Starter Kit`,document.getElementById("company-logo-creds").style=window.resellerConfig.distributor.LogoCss,document.getElementById("company-logo-creds").setAttribute("src",window.resellerConfig.distributor.LogoUrl)),window.resellerConfig.hasOwnProperty("LogoUrl")&&(document.getElementById("company-logo-left-menu").setAttribute("src",window.resellerConfig.LogoUrl),window.resellerConfig.LogoUrl.match(/no-csk-logo.png$/)||document.getElementById("company-logo-creds").setAttribute("src",window.resellerConfig.LogoUrl)),window.resellerConfig.hasOwnProperty("LogoCss")?(document.getElementById("company-logo-left-menu").style=window.resellerConfig.LogoCss,window.resellerConfig.LogoUrl.match(/no-csk-logo.png$/)||(document.getElementById("company-logo-creds").style=window.resellerConfig.LogoCss)):(window.resellerConfig.hasOwnProperty("LogoCssLeft")&&(document.getElementById("company-logo-left-menu").style=window.resellerConfig.LogoCssLeft),window.resellerConfig.hasOwnProperty("LogoCssRight")&&(document.getElementById("company-logo-creds").style=window.resellerConfig.LogoCssRight))}addEventListener("KEY_FOUND",keyFound);let lastData=null;async function phoneHome(e){if(window.hosts){e.csk_id=window.resellerConfig.csk_id,e.partner_name=window.resellerConfig.AWSDistributorName,e.country_code=window.resellerConfig.CountryCode;e=JSON.stringify(e);if(lastData!==e){lastData=e;try{var t=lastData,n=await fetch(`https://${window.hosts.ADMIN_HOST}/app/reporting/report`,{method:"POST",headers:{"Content-Type":"application/json","x-csk":window.resellerConfig.csk_id},body:t});await n.arrayBuffer()}catch(e){}}}}function tryLogin(){window.checkIfCredsAvailable(credentialsCallback)}function addCredentials(){let e=document.getElementById("pasted-credentials").value;document.getElementById("access-key-id").value&&document.getElementById("secret-access-key").value&&(e="AWS_ACCESS_KEY_ID="+document.getElementById("access-key-id").value+"\nAWS_SECRET_ACCESS_KEY="+document.getElementById("secret-access-key").value+"\n"),window.setCredentials(e,credentialsCallback)}function credentialsCallback(e,t){if(e)displayCredentialErrors(!0,e),document.getElementById("pasted-credentials").value="";else if(t){window.loggedIn=!0,phoneHome({action:"logged in"}),displayCredentialErrors(!1),displaySessionErrors(null,t),account!==t.AWS_ACCOUNT_ID&&(phoneHome({action:"switched account"}),resetStackMonitoring()),account=t.AWS_ACCOUNT_ID;let e="";for(var n in t)e+="<b>"+n+"</b>: "+t[n]+"<br/>\n";document.getElementById("credentials-block").hidden=!0,document.getElementById("account-display").innerText=account,lockRegionControls(!0),showPrepareRegionModal(!0),showAliasForAccount(account),populateRegionsSelect(),extendLoadDelay();try{resetAllKitMonitors(),switchLeftMenuItem({target:{id:"install-a-kit-button",content:"starter-kits"}})}catch(e){}}}function showAliasForAccount(e){var t=getValueInNamespace(e,"alias");t?document.getElementById("account-alias").innerText=t:writeInputForAlias(e)}function resetAlias(){writeInputForAlias(account)}function writeInputForAlias(t){setValueInNamespace(t,"alias",""),document.getElementById("account-alias").innerText="";let n=document.createElement("input");n.type="text",n.id="account-alias-input",n.placeholder="Account owner...",n.onkeyup=e=>{"Enter"!==e.key&&13!==e.keyCode||(setValueInNamespace(t,"alias",n.value),document.getElementById("account-alias").innerText=n.value)},document.getElementById("account-alias").appendChild(n)}let kitConfigsShowing={};function configureKit(e){var t=kitMetadata[e],t=(kitConfigsShowing[e]=!0,(t.hasOwnProperty("Templates")?displayTemplateConfig:displayCdkAppConfig)(e),document.getElementById(e+"-config-pane")),n=document.getElementById(e+"-config-button"),a=document.getElementById(e+"-install-button"),e=document.getElementById(e+"-cancel-button");t&&(t.style.display="block",n.style.display="none",a.style.display="block",e.style.display="block")}function hideConfigForKit(e){var t=document.getElementById(e+"-config-pane"),n=document.getElementById(e+"-config-button"),a=document.getElementById(e+"-install-button"),s=document.getElementById(e+"-cancel-button");t&&(t.style.display="none",n.style.display="block",a.style.display="none",s.style.display="none",delete kitConfigsShowing[e])}function installKit(e){var t=kitMetadata[e];document.getElementById(e+"-install-button").disabled=!0,document.getElementById(e+"-deployment-progress").style.display="block",toggleDeploymentDetails(e),(t.hasOwnProperty("Templates")?deployCfnTemplate:deployCdkApp)(e)}function reenableKitButton(e){document.getElementById(e+"-install-button")&&(document.getElementById(e+"-install-button").disabled=!1)}function showDeleteKitButton(e){document.getElementById(e+"-delete-button")&&(document.getElementById(e+"-delete-button").style.display="inline")}function deleteKit(e){var t=kitMetadata[e];document.getElementById(e+"-delete-button").disabled=!0,(t.hasOwnProperty("Templates")?deleteCfnStack:destroyCdkApp)(e)}function deleteCfnStack(e){}function destroyCdkApp(e){}function showCategory(e){var t,n=document.getElementById(e);n.style.display="block";for(t of n.parentNode.children)t!==n&&(t.style.display="none");var a,s=document.getElementById(e+"-selector"),e=(s.classList.add("category-selector-selected"),document.getElementById("kit-category-selector"));for(a of e.children)a!==s&&a.classList.remove("category-selector-selected")}function toggleDeploymentDetails(e){e=document.getElementById(e+"-deployment-details");"none"===e.style.display?e.style.display="block":e.style.display="none"}function getAllKitsMetadata(){window.getFullCatalogue(i=>{var r,e=document.getElementById("starter-kits"),t=document.createElement("div"),n=(t.classList.add("category-container"),e.appendChild(t),document.createElement("div")),a=(n.classList.add("scrollable"),e.appendChild(n),[]);for(r in i){var l,s=r.toLowerCase().replaceAll(/\s/g,"-"),o=(defaultCategory=defaultCategory||s,document.createElement("div")),d=(o.classList.add("category-selector"),o.id=s+"-selector",document.createElement("a")),c=(d.innerText=r,o.appendChild(d),o.setAttribute("onclick",`showCategory('${s}')`),a.push(o),document.createElement("div")),d=(c.className="top-level-category",c.id=s,c.style.display="none",document.createElement("h2")),o=(d.classList.add("heading"),d.innerText=r,document.createElement("p"));for(l in appendHtmlToNode(o,i[r].Description),c.appendChild(d),c.appendChild(o),i[r].Categories){var u=document.createElement("h3"),m=(u.classList.add("sub-heading"),u.innerText=l,document.createElement("p"));m.classList.add("category-description"),appendHtmlToNode(m,i[r].Categories[l].Description),c.appendChild(u),c.appendChild(m);for(let o=0;o<i[r].Categories[l].Kits.length;o++){var p=i[r].Categories[l].Kits[o];let e="cfn";var g=(e=p.hasOwnProperty("Manifest")?"cdk":e)+"-"+p.Name.toLowerCase().replace(/\s/g,"-").replace(/[^a-zA-Z0-9\-]/g,""),E=document.createElement("div"),w=(E.className="kit",E.id=g,document.createElement("h4"));w.classList.add("sub-sub-heading");let t=p.Name;(kitMetadata[g]=p).hasOwnProperty("UploadRequired")&&(t+=" 🪣"),p.hasOwnProperty("VpcRequired")&&p.VpcRequired&&(t+=" ☁️"),w.innerText=t;var h=document.createElement("p");appendHtmlToNode(h,p.Description.replaceAll("<br>","</p><p>"));let n=null,a=(p.hasOwnProperty("CostCalculator")&&p.CostCalculator&&((n=document.createElement("p")).classList.add("cost-calculator"),(y=document.createElement("a")).setAttribute("href",p.CostCalculator),y.setAttribute("target","_blank"),y.innerText="Cost Calculator",n.appendChild(y)),null),s=(p.hasOwnProperty("Copyright")&&p.Copyright&&((a=document.createElement("p")).classList.add("copyright"),a.innerText=p.Copyright),null);p.hasOwnProperty("MoreInfo")&&p.MoreInfo&&((s=document.createElement("div")).classList.add("kit-more-info"),appendHtmlToNode(s,p.MoreInfo));var y=document.createElement("button"),k=(y.id=g+"-config-button",y.innerText="Configure "+p.Name,y.setAttribute("onclick",`configureKit('${g}')`),document.createElement("button")),p=(k.id=g+"-install-button",k.innerText="Install "+p.Name,k.setAttribute("onclick",`installKit('${g}')`),k.style.display="none",document.createElement("button")),f=(p.id=g+"-delete-button",p.innerText="Delete",p.setAttribute("onclick",`deleteKit('${g}')`),p.style.display="none",document.createElement("button")),S=(f.id=g+"-cancel-button",f.innerText="Cancel",f.setAttribute("onclick",`hideConfigForKit('${g}')`),f.style.display="none",f.style.float="right",document.createElement("div")),T=(S.id=g+"-config-pane",document.createElement("p")),T=(T.innerText="Loading configuration options for this kit - please wait.",S.appendChild(T),S.style.display="none",document.createElement("div")),I=(T.classList.add("logs"),T.id=g+"-deployment-progress",document.createElement("div")),v=(I.classList.add("progress-bar-striped"),I.setAttribute("onclick",`toggleDeploymentDetails('${g}')`),I.id=g+"-deployment-progress-bar",document.createElement("div")),A=(v.style.width="100%",document.createElement("b")),b=document.createElement("p"),A=(A.appendChild(b),v.appendChild(A),I.appendChild(v),document.createElement("p")),I=(A.classList.add("progress-bar-message"),T.appendChild(I),T.appendChild(A),progressBars[g]=[b,v,A],document.createElement("div")),b=(I.id=g+"-deployment-details",document.createElement("h5")),v=(b.innerText="Deployment Request Response",I.appendChild(b),document.createElement("div")),A=(v.id=g+"-deploystack-output",v.classList.add("output","pre"),I.appendChild(v),document.createElement("h5")),b=(A.innerText="CloudFormation Events",I.appendChild(A),document.createElement("div")),v=(b.id=g+"-cf-stack-states",b.classList.add("output"),I.appendChild(b),document.createElement("h5")),A=(v.innerText="Stack Outputs",I.appendChild(v),document.createElement("div"));A.id=g+"-cf-stack-outputs",A.classList.add("output"),I.appendChild(A),I.style.display="none",T.appendChild(I),T.style.display="none",E.appendChild(w),(kitDescColumns=document.createElement("div")).classList.add("kit-desc-columns"),kitDescColumns.appendChild(h),a&&h.appendChild(a),n&&h.appendChild(n),s&&kitDescColumns.appendChild(s),E.appendChild(kitDescColumns),E.appendChild(y),E.appendChild(S),E.appendChild(f),E.appendChild(k),E.appendChild(p),E.appendChild(T),c.appendChild(E)}}n.appendChild(c)}t.style.columns=a.length,t.id="kit-category-selector";for(let e=0;e<a.length;e++)t.appendChild(a[e]);showCategory(defaultCategory)})}function populateRegionsSelect(){window.getRegions((e,n)=>{if(!e){for(var a=getValueInNamespace(account,"SelectedRegion")||window.resellerConfig.DefaultRegion,s=document.getElementById("region-select");s.firstChild;)s.removeChild(s.firstChild);let t=!1;var o=[],i={};for(let e=0;e<n.Regions.length;e++){var r=convertRegionCodeToName(n.Regions[e].RegionName);o.push(r),i[r]=n.Regions[e].RegionName}o.sort();for(let e=0;e<o.length;e++){i[o[e]]===a&&(t=!0);var l=document.createElement("option");l.text=o[e],l.value=i[o[e]],s.add(l)}t?s.value=a:(s.value="ap-southeast-2",displayErrors(`Region ${a} is not available, probably because it is an opt-in Region. Click the link to open the AWS console and resolve this.`,"https://us-east-1.console.aws.amazon.com/billing/home?region=us-east-1#/account")),updateRegion()}})}function afterRegionOptIn(e,t){}function hideLoadingBlock(){document.getElementById("loading-block").style.display="none"}let allowedVpcs={},hasAllowedVpcs=!1;function updateVpcs(){window.getVpcs((e,t)=>{if(!e){window.vpcs=t.Vpcs;for(let e=0;e<window.vpcs.length;e++)!1===window.vpcs[e].IsDefault&&"available"===window.vpcs[e].State&&(allowedVpcs[window.vpcs[e].VpcId]=window.vpcs[e],hasAllowedVpcs=!0);vpcStatus(),hasAllowedVpcs&&window.getSubnets((e,t)=>{if(!e){var n,a,s={},o=[];for(let e=0;e<t.Subnets.length;e++)s.hasOwnProperty(t.Subnets[e].VpcId)||(s[t.Subnets[e].VpcId]=[]),s[t.Subnets[e].VpcId].push(t.Subnets[e]);for(n in s){for(let t=0;t<s[n].length;t++)for(let e=0;e<s[n].length;e++)s[n][t].AvailabilityZone<s[n][e].AvailabilityZone&&(a=s[n][t],s[n][t]=s[n][e],s[n][e]=a);for(var i=0;i<s[n].length;i++)o.push(s[n][i])}window.subnets=o,dispatchEvent(new Event("UI_DATA_UPDATE"))}})}})}function fetchKeyPairs(){window.getEc2KeyPairs((e,t)=>{e||(window.keyPairs=t.KeyPairs,dispatchEvent(new Event("UI_DATA_UPDATE")))})}function createKeyPair(){addToTaskQueue(new Task(TASK_TYPES.CREATE_KEY,"create-key-pair")),window.generateKeyPair(document.getElementById("region-select").value,(e,t)=>{e||(window.keyPairs.push(t),dispatchEvent(new Event("KEY_READY")),dispatchEvent(new Event("UI_DATA_UPDATE")),window.api.saveFile(t.KeyName,t.KeyMaterial))})}function extendLoadDelay(e=3e3){loadBlockTimeout&&clearTimeout(loadBlockTimeout),loadBlockTimeout=setTimeout(()=>{dispatchEvent(new Event(TASK_EVENTS.LOADING_COMPLETE))},e)}function checkDeliveryStackCompleteness(){let a=setInterval(function(n){window.getStackStatus(n,(e,t)=>{if(!e&&t.hasOwnProperty("Stacks")&&t.Stacks[0].hasOwnProperty("StackStatus")&&"CREATE_COMPLETE"===t.Stacks[0].StackStatus){if(0<t.Stacks[0].Outputs.length)for(let e=0;e<t.Stacks[0].Outputs.length;e++)"CskSourceBucketName"===t.Stacks[0].Outputs[e].ExportName?setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[e].OutputValue):"CskPipelineName"===t.Stacks[0].Outputs[e].ExportName&&setValueInNamespace(account+"-"+region,"PipelineName",t.Stacks[0].Outputs[e].OutputValue);dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:n})),clearInterval(a)}})},5e3,"csk-cdk-app-delivery-pipeline-stack")}function lockRegionControls(e){document.getElementById("region-select").disabled=e,document.getElementById("switch-accounts-button").hidden=e}function showPrepareRegionModal(e){e?(document.getElementById("modal-block").style.display="block",document.getElementById("modal-message").innerText="Preparing Region...",document.getElementById("background-view").style.filter="blur(4px)"):(document.getElementById("background-view").style.filter="none",document.getElementById("modal-block").style.display="none")}function updateRegion(e=0){region=document.getElementById("region-select").value,document.getElementById("region-map").setAttribute("src",`images/world_map-${region}.svg`),window.setRegion(region),lockRegionControls(!0),showPrepareRegionModal(!0),addToTaskQueue(new Task(Task.TYPES.REGIONAL_DATA_LOADING,region)),addToTaskQueue(new Task(Task.TYPES.REGIONAL_PIPELINE_BUILD,region));let t=setInterval(()=>{regionControlsCanBeUnlocked()&&(lockRegionControls(!1),showPrepareRegionModal(!1),clearInterval(t))},3e3);window.prepareRegion((e,t)=>{if(t&&t.hasOwnProperty("Stacks")&&0<t.Stacks[0].Outputs.length){for(let e=0;e<t.Stacks[0].Outputs.length;e++)"CskSourceBucketName"===t.Stacks[0].Outputs[e].ExportName?setValueInNamespace(account+"-"+region,"SourceBucket",t.Stacks[0].Outputs[e].OutputValue):"CskPipelineName"===t.Stacks[0].Outputs[e].ExportName&&setValueInNamespace(account+"-"+region,"PipelineName",t.Stacks[0].Outputs[e].OutputValue);dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_COMPLETE,{detail:"csk-cdk-app-delivery-pipeline-stack"}))}else t&&t.hasOwnProperty("StackId")&&t.StackId.match("csk-cdk-app-delivery-pipeline-stack")?checkDeliveryStackCompleteness():e&&(displayErrors("Error creating delivery pipeline: "+e.message),dispatchEvent(new CustomEvent(TASK_EVENTS.DEPLOYMENT_FAILED,{detail:"csk-cdk-app-delivery-pipeline-stack"})))}),setValueInNamespace(account,"SelectedRegion",region),regionSelected=!0,listAllStacks(),allowedVpcs={},hasAllowedVpcs=!1,updateVpcs(),fetchKeyPairs(),resetAmiInstanceTypeLists(),fetchAmis(),getInstanceTypes(),resetDbInfraLists(),getAllDbEngines()}function getCurrentValues(t){var n={},a=templateParameters.hasOwnProperty(t)?templateParameters[t]:[];for(let e=0;e<a.length;e++)n[a[e]]=document.getElementById(t+"|"+a[e]).value;return n}async function displayTemplateConfig(s){var e=kitMetadata[s],o=getCurrentValues(s);if(regionSelected){var i=e.Templates,r=e.hasOwnProperty("AmiFilter")?e.AmiFilter:"",l=e.hasOwnProperty("DbEngineFilter")?e.DbEngineFilter:"";let n="<div>",t=(n=(n+=`<input id="AWSDistributorName" type="hidden" value="${window.resellerConfig.AWSDistributorName}" name="AWSDistributorName" required>`)+`<input id="CountryCode" type="hidden" value="${window.resellerConfig.CountryCode}" name="CountryCode" required>`+'<input id="ReportingEnabled" type="hidden" value="false" name="ReportingEnabled" required>',!(templateParameters[s]=[])),a="griditemlight";for(let e=0;e<i.length;e++){var d=i[e],c=await(await fetch(`https://${window.hosts.FILE_HOST}/kits/cfn-templates/`+d,{method:"GET",headers:{"x-access-control":JSON.parse(localStorage.getItem("kitConfig")).KitHubCode}})).json();if(c.hasOwnProperty("Metadata")&&c.Metadata.hasOwnProperty("AWS::CloudFormation::Interface")&&c.Metadata["AWS::CloudFormation::Interface"].hasOwnProperty("ParameterGroups")){t=!0;var u=c.Metadata["AWS::CloudFormation::Interface"].ParameterGroups;for(let t=0;t<u.length;t++)if(!u[t].Label.default.match(/Starter-kit Specific Details/i)){n+=makeGroupLabel(u[t].Label.default);for(let e=0;e<u[t].Parameters.length;e++){var m=u[t].Parameters[e];templateParameters[s].push(m),m.match(/AWSDistributorName|ReportingEnabled/)||(n+=makeConfigRow(s,a,m,c.Parameters,r,l,o),a="griditemdark"===a?"griditemlight":"griditemdark")}n+="</div></div>"}}else if(c.hasOwnProperty("Parameters")){for(var p in t=!0,n+='<div class="config">',c.Parameters)templateParameters[s].push(p),p.match(/AWSDistributorName|ReportingEnabled/)||(n+=makeConfigRow(s,a,p,c.Parameters,r,l,o),a="griditemdark"===a?"griditemlight":"griditemdark");n+="</div>"}n+="</div>"}t||(n+='<p class="no-config">No configuration required for this kit.</p>'),appendHtmlToNode(document.getElementById(s+"-config-pane"),n,!0),document.getElementById("create-key-pair-button")&&document.getElementById("create-key-pair-button").addEventListener("click",createKeyPair),setTimeout(filterAmis,200),setTimeout(filterSubnets,200),setTimeout(filterDbInstanceClasses,200)}}function makeConfigRow(e,t,n,a,s,o,i){let r="",l="";a[n].hasOwnProperty("InfoLink")&&(l=`(<a href="${a[n].InfoLink}" target="_blank">more info...</a>)`);var d=a[n].hasOwnProperty("Label")?a[n].Label:n;r=r+`<div class="${t}"><label style="margin: 0px" for="${n}">${d}</label><br><small><i>${a[n].Description} ${l}</i></small><br>`+`</div><div class="${t}">`;try{r+=makeInputElement(e,a[n],n,s,o,i[n])}catch(e){r+="Error rendering input for "+n}return r+="</div>"}function makeGroupLabel(e){var t="";return(t+='<div class="parameter-group">')+`<p class="parameter-heading">${e}</p>`+'<div class="config">'}async function displayCdkAppConfig(s){var e=kitMetadata[s],o=getCurrentValues();if(regionSelected){var t=e.Manifest,i=e.hasOwnProperty("AmiFilter")?e.AmiFilter:"",r=e.hasOwnProperty("DbEngineFilter")?e.DbEngineFilter:"";if(t){var l=await(await fetch(`https://${window.hosts.FILE_HOST}/kits/cdk-apps/`+t,{method:"GET",headers:{"x-access-control":JSON.parse(localStorage.getItem("kitConfig")).KitHubCode}})).json();let n="<div>",e=(n=(n=(n+='<div class="config">')+`<input id="AWSDistributorName" type="hidden" value="${window.resellerConfig.AWSDistributorName}" name="AWSDistributorName" required>`)+`<input id="CountryCode" type="hidden" value="${window.resellerConfig.CountryCode}" name="CountryCode" required>`,!1),a=(templateParameters[s]=[],"griditemlight");if(l.hasOwnProperty("ParameterGroups")&&0<Object.keys(l.ParameterGroups).length){e=!0;var d=l.ParameterGroups;for(let t=0;t<d.length;t++){n+=makeGroupLabel(d[t].Label.default);for(let e=0;e<d[t].Parameters.length;e++){var c=d[t].Parameters[e];templateParameters[s].push(c),n+=makeConfigRow(s,a,c,l.Parameters,i,r,o),a="griditemdark"===a?"griditemlight":"griditemdark"}n+="</div></div>"}}else if(l.hasOwnProperty("Parameters")&&0<Object.keys(l.Parameters).length)for(var u in e=!0,l.Parameters)templateParameters[s].push(u),"AWSDistributorName"!==u&&(n+=makeConfigRow(s,a,u,l.Parameters,i,r,o),a="griditemdark"===a?"griditemlight":"griditemdark");e||(n+='<p class="no-config">No configuration required for this kit.</p>'),n+="</div></div>",appendHtmlToNode(document.getElementById(s+"-config-pane"),n,!0),setTimeout(filterAmis,200),setTimeout(filterSubnets,200),setTimeout(filterDbInstanceClasses,200)}else document.getElementById(s+"-config-pane").innerText="No manifest file found."}}function focusOff(e){e.target.value?e.target.checkValidity()?(e.target.className="valid",setValueInNamespace(account,e.id,e.target.value)):e.target.className="invalid":e.target.className="empty"}function vpcStatus(){hasAllowedVpcs?document.getElementById("no-vpc-warning").hidden=!0:document.getElementById("no-vpc-warning").hidden=!1}function makeInputElement(e,a,s,t,n,o=null){o&&(a.Default=o);let i="",r=e+"|"+s;if(s.match(/^InstanceType$/i)){i=`<select id="${r}" name="${s}" class="instance-type-selector" style="background-color: white" onchange="filterAmis()">`;let e=null;for(var l in window.instanceTypes){var d=l.split(".")[0];e!==d&&(null!==e&&(i+="</optgroup>"),i+=`<optgroup label="${d}">`,e=d),i+=`<option arch="${window.instanceTypes[l].ProcessorInfo.SupportedArchitectures[0]}" value="${l}">${l} - (${window.instanceTypes[l].ProcessorInfo.SupportedArchitectures[0]}) ${window.instanceTypes[l].VCpuInfo.DefaultVCpus} vCPUs, ${Number(window.instanceTypes[l].MemoryInfo.SizeInMiB)/1024} GB</option>`}i+="</optgroup></select>"}else if(a.hasOwnProperty("AllowedValues"))if(2==a.AllowedValues.length&&1==a.AllowedValues[0]&&0==a.AllowedValues[1])i=`<input class="checkbox" id="${r}" name="${s}" type="checkbox" style="background-color: #1095c1" value="${a.AllowedValues[0]}" checked>`;else{i=`<select id="${r}" name="${s}" style="background-color: white">`;for(let e=0;e<a.AllowedValues.length;e++)i+=`<option value="${a.AllowedValues[e]}"`,a.AllowedValues[e]===a.Default&&(i+=" selected"),i+=`>${a.AllowedValues[e]}</option>`;i+="</select>"}else if(a.hasOwnProperty("Type"))if("AWS::EC2::VPC::Id"===a.Type){for(var c in i=`<select id="${r}" name="${s}" class="vpc-selector" style="background-color: white" onchange="filterSubnets()">`,allowedVpcs){var u=findNameFromTags(allowedVpcs[c].Tags)||allowedVpcs[c].VpcId;i+=`<option value="${allowedVpcs[c].VpcId}">${u} - ${allowedVpcs[c].CidrBlock}</option>`}i+="</select>"}else if("AWS::EC2::Subnet::Id"===a.Type){i=`<select id="${r}" name="${s}" class="subnet-selector" style="background-color: white">`;let t=window.subnets[0].VpcId;i+=`<optgroup label="${window.subnets[0].VpcId}">`;for(let e=0;e<window.subnets.length;e++){var m;allowedVpcs[window.subnets[e].VpcId]&&(window.subnets[e].VpcId!==t&&(i+=`</optgroup><optgroup label="${window.subnets[e].VpcId}">`,t=window.subnets[e].VpcId),m=findNameFromTags(window.subnets[e].Tags)||window.subnets[e].SubnetId,i+=`<option az="${window.subnets[e].AvailabilityZone}" vpc="${window.subnets[e].VpcId}" value="${window.subnets[e].SubnetId}">${m} - ${window.subnets[e].CidrBlock} - ${window.subnets[e].AvailabilityZone}</option>`)}i+="</optgroup></select>"}else if("AWS::EC2::KeyPair::KeyName"===a.Type){i=`<select id="${r}" name="${s}" style="background-color: white">`;for(let e=0;e<window.keyPairs.length;e++)i+=`<option value="${window.keyPairs[e].KeyName}">${window.keyPairs[e].KeyName}</option>`;i+="</select>",0===window.keyPairs.length&&(i+=' <button id="create-key-pair-button">Create Key Pair</button>')}else if("CSK::DbEngineVersion"===a.Type){if(i=`<select id="${r}" name="${s}" style="background-color: white" class="dbengine-selector" onchange="filterDbInstanceClasses()">`,n){for(var p in window.dbEngines[n])i+=`<option engine="${n}" value="${p}">${window.dbEngines[n][p].DBEngineVersionDescription}</option>`;i+="</select>"}}else if("CSK::DbInstanceClass"===a.Type)i=`<select id="${r}" name="${s}" class="instance-class-selector" onchange="instanceClassSet(this)" style="background-color: white" onchange="storeInstanceClassState('${r}')"><option>Choose the DB engine first</option></select><br><p style="margin: -5px 2px; font-weight:bold" id="${r}-message"></p>`;else if("AWS::EC2::Image::Id"===a.Type){if(i=`<select id="${r}" name="${s}" style="background-color: white" class="ami-selector" onchange="storeAmiState('${r}')">`,!t||"Windows"===t){i+='<optgroup label="Windows">';for(let e=0;e<window.amis.windows.length;e++)i+=`<option os="Windows" arch="${window.amis.windows[e].Architecture}" value="${window.amis.windows[e].ImageId}">${window.amis.windows[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}if(!t||"AmazonLinux"===t){i+='<optgroup label="Amazon Linux 2023">';for(let e=0;e<window.amis.linux2023.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2023[e].Architecture}" value="${window.amis.linux2023[e].ImageId}">${window.amis.linux2023[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2023 (Arm)">';for(let e=0;e<window.amis.linux2023Arm.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2023Arm[e].Architecture}" value="${window.amis.linux2023Arm[e].ImageId}">${window.amis.linux2023Arm[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2">';for(let e=0;e<window.amis.linux2.length;e++)i+=`<option os="Linux" arch="${window.amis.linux2[e].Architecture}" value="${window.amis.linux2[e].ImageId}">${window.amis.linux2[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Amazon Linux 2 (Arm)">';for(let e=0;e<window.amis.linuxArm.length;e++)i+=`<option os="Linux" arch="${window.amis.linuxArm[e].Architecture}" value="${window.amis.linuxArm[e].ImageId}">${window.amis.linuxArm[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}if(!t||"Ubuntu"===t){i+='<optgroup label="Ubuntu">';for(let e=0;e<window.amis.ubuntu.length;e++)i+=`<option os="Linux" arch="${window.amis.ubuntu[e].Architecture}" value="${window.amis.ubuntu[e].ImageId}">${window.amis.ubuntu[e].ShortName.split("/").pop()}</option>`;i+='</optgroup><optgroup label="Ubuntu (Arm)">';for(let e=0;e<window.amis.ubuntuArm.length;e++)i+=`<option os="Linux" arch="${window.amis.ubuntuArm[e].Architecture}" value="${window.amis.ubuntuArm[e].ImageId}">${window.amis.ubuntuArm[e].ShortName.split("/").pop()}</option>`;i+="</optgroup>"}i+="</select>"}else{let e=null,t=(a.hasOwnProperty("AllowedPattern")&&(e=(e=a.AllowedPattern.replace(String.fromCharCode(92,92),String.fromCharCode(92))).replace(String.fromCharCode(47),String.fromCharCode(92,47))),document.createElement("input")),n=(e&&(t.pattern=e),50<=Number(a.MaxLength)?t=document.createElement("textarea"):"String"===a.Type?(t.setAttribute("type","text"),a.hasOwnProperty("MaxLength")&&(t.maxLength=a.MaxLength),a.hasOwnProperty("MinLength")&&(t.minLength=a.MinLength)):"Number"===a.Type&&(t.setAttribute("type","number"),a.hasOwnProperty("MinValue")&&(t.min=a.MinValue),a.hasOwnProperty("MaxValue"))&&(t.max=a.MaxValue),getValueInNamespace(account,r));"0.0.0.0/0"!==(n=""===n?a.hasOwnProperty("Default")?a.Default:"":n)&&"CSK::UserIp"!==a.Type||getMyIp().then(e=>{document.getElementById(r).value=e+"/32"}),t.setAttribute("id",r),t.setAttribute("name",s),t.defaultValue=n,t.required=!0,setTimeout(()=>{document.getElementById(r).onfocus=focusOff,document.getElementById(r).onblur=focusOff,document.getElementById(r).onkeyup=focusOff},2e3),t.setAttribute("style","background-color: white"),i=t.outerHTML}return i}function filterSubnets(){var s=document.getElementsByClassName("vpc-selector");for(let a=0;a<s.length;a++){var e=s[a].id.split("|")[0],o=document.getElementsByClassName("subnet-selector");let n=null;for(let t=0;t<o.length;t++){var i=o[t].id.split("|")[0];if(i===e){for(let e=0;e<o[t].options.length;e++)o[t].options[e].hidden=!1;for(let e=0;e<o[t].options.length;e++)o[t].options[e].getAttribute("vpc")!==s[a].value?o[t].options[e].hidden=!0:(null===n&&(n=e),o[t].options[e].hidden=!1);o[t].selectedIndex=n}}}}addEventListener("POST_STACK_UPDATE",updateVpcs),addEventListener("UI_DATA_UPDATE",()=>{extendLoadDelay(1e3)}),addEventListener("EXTEND_LOAD_DELAY",()=>{extendLoadDelay(3e3)}),RegExp.quote=function(e){return e=(e=e.replaceAll(/([<>])/g,"\\$1")).replaceAll(/-]/g,"\\-]")};let lastDbInstanceClassSelected=null;function storeInstanceClassState(){var t=document.getElementsByClassName("instance-class-selector");for(let e=0;e<t.length;e++)-1<t[e].selectedIndex&&(lastDbInstanceClassSelected=t[e].value)}function filterDbInstanceClasses(){var n=document.getElementsByClassName("dbengine-selector");for(let t=0;t<n.length;t++){var a=n[t].id.split("|")[0],s=document.getElementsByClassName("instance-class-selector");for(let e=0;e<s.length;e++){var o=s[e].id.split("|")[0];if(o===a){var i,r,o=s[e].value,l=(s[e].innerHTML="",window.dbInstances[n[t].options[n[t].selectedIndex].getAttribute("engine")][n[t].value]),d={},c={};for(i in l){var u=i.split(".")[1];d.hasOwnProperty(u)||(c[u]=document.createElement("optgroup"),d[c[u].label=u]=!0),c[u].appendChild(new Option(i,i))}for(r in c)s[e].appendChild(c[r]);s[e].value=o,instanceClassSet(s[e])}}}}function instanceClassSet(e){-1===e.selectedIndex?document.getElementById(e.id+"-message").innerText="Please select an instance class":document.getElementById(e.id+"-message").innerText=""}let osType=null,currentArch={},lastArmAmi={},lastX86Ami={};function storeAmiState(t){var n=document.getElementsByClassName("ami-selector");for(let e=0;e<n.length;e++)-1<n[e].selectedIndex&&("arm64"===n[e].options[n[e].selectedIndex].getAttribute("arch")?lastArmAmi[t]=n[e].value:lastX86Ami[t]=n[e].value)}function filterAmis(){var n=document.getElementsByClassName("instance-type-selector");for(let e=0;e<n.length;e++){var a=-1<n[e].selectedIndex?n[e].options[n[e].selectedIndex].getAttribute("arch"):null,s=n[e].id,o=s.split("|")[0],i=document.getElementsByClassName("ami-selector"),r=a||"x86_64";let t=null;for(let e=0;e<i.length;e++){var l=i[e],d=l.id,c=d.split("|")[0];if(c===o&&(lastArmAmi.hasOwnProperty(d)||(lastArmAmi[d]=null),lastX86Ami.hasOwnProperty(d)||(lastX86Ami[d]=null),currentArch.hasOwnProperty(d)||(currentArch[d]=null),!currentArch[d]||r!==currentArch[d])){for(let e=0;e<l.options.length;e++)l.options[e].hidden=!1;if("arm64"===r&&lastArmAmi[s]){l.value=lastArmAmi[s];for(let e=0;e<l.options.length;e++)if(l.options[e].value===lastArmAmi[s]){t=e;break}l.selectedIndex=t}else if("x86_64"===r&&lastX86Ami[s]){l.value=lastX86Ami[s];for(let e=0;e<l.options.length;e++)if(l.options[e].value===lastX86Ami[s]){t=e;break}l.selectedIndex=t}else if(-1<l.selectedIndex){if(l.options[l.selectedIndex].getAttribute("arch")!==r){for(let e=0;e<l.options.length;e++)if(l.options[e].getAttribute("arch")===r){t=e;break}l.selectedIndex=t}}else{for(let e=0;e<l.options.length;e++)if(l.options[e].getAttribute("arch")===r){t=e;break}l.selectedIndex=t}for(let e=0;e<l.options.length;e++)l.options[e].getAttribute("arch")!==r?(l.options[e].selected=!1,l.options[e].hidden=!0):l.options[e].hidden=!1;currentArch[d]=r,storeAmiState(d)}}}}let debounceWaiter=null;function debounceDisplayTemplateConfig(){debounceWaiter&&clearTimeout(debounceWaiter),debounceWaiter=setTimeout(refreshFormElements,300)}function refreshFormElements(){for(var e in kitConfigsShowing)configureKit(e)}function displayCredentialErrors(e,t){e?(document.getElementById("credential-errors").innerText=t,document.getElementById("credential-error-block").hidden=!1):(document.getElementById("credential-errors").innerText="",document.getElementById("credential-error-block").hidden=!0)}function displayErrors(e,t=null){"object"==typeof e&&(e=e.toString()),document.getElementById("general-errors").innerText=e,t&&((e=document.createElement("a")).href=t,e.target="_blank",e.innerText="Click here to open console",e.style.cursor="pointer",e.style.marginLeft="6px",e.style.display="inline-block",e.addEventListener("click",e=>{window.openInBrowser(t),e.stopPropagation()}),document.getElementById("general-errors").appendChild(e)),document.getElementById("general-error-block").hidden=!1}function hideErrors(){document.getElementById("general-error-block").hidden=!0,document.getElementById("general-errors").innerText=""}function displaySessionErrors(e,t){let n="";e&&e.toString().match(/Missing credentials in config, if using AWS_CONFIG_FILE, set AWS_SDK_LOAD_CONFIG=1/)?n="Waiting for credentials...":e&&(n=e.toString()),n?(window.loggedIn=!1,document.getElementById("session-errors").innerText=n,document.getElementById("session-error-block").style.display="block",document.getElementById("pasted-credentials").innerText="",switchLeftMenuItem({target:{id:"switch-accounts-button",content:"credentials-block"}})):(window.loggedIn=!0,document.getElementById("session-error-block").style.display="none",document.getElementById("session-errors").innerText="")}let previousLanguage=null;function setLanguage(){var e=document.getElementById("lang-select").value;null!==previousLanguage&&phoneHome({action:"switched language to "+e}),previousLanguage=e,window.dispatchEvent(new Event("LanguageChange"))}function checkSessionWrapper(){window.checkSession(displaySessionErrors)}function resetUi(){document.getElementById("no-vpc-warning").hidden=!0,document.getElementById("session-error-block").style.display="none",document.getElementById("general-error-block").hidden=!0,document.getElementById("sdk-output").hidden=!1,document.getElementById("loading-block").style.display="block",document.getElementById("credentials-block").hidden=!1,document.getElementById("credential-error-block").hidden=!0,document.getElementById("pasted-credentials").innerText=""}function openRightMenu(){document.getElementById("right-hand-menu").style.display="block",document.getElementById("right-hand-menu-closed").style.display="none",document.getElementById("main-content-area").addEventListener("click",closeRightMenu),document.getElementById("main-content-area").classList.add("scrunched")}function closeRightMenu(){document.getElementById("right-hand-menu").style.display="none",document.getElementById("right-hand-menu-closed").style.display="block",document.getElementById("main-content-area").removeEventListener("click",closeRightMenu),document.getElementById("main-content-area").classList.remove("scrunched")}setInterval(checkSessionWrapper,6e4);let lastContentRequested=null;function switchLeftMenuItem(e){var t=e.target.hasOwnProperty("content")?e.target.content:e.target.getAttribute("content");if(t!==lastContentRequested){var n=document.getElementsByClassName("left-hand-menu-item");for(let e=0;e<n.length;e++){n[e].classList.remove("left-hand-menu-item-selected");var a=n[e].getAttribute("content");a&&(document.getElementById(a).hidden=!0)}document.getElementById(t).hidden=!1,phoneHome({action:"switched to "+t}),document.getElementById(e.target.id).classList.add("left-hand-menu-item-selected"),lastContentRequested=t}"deployed-stacks"===t&&listAllStacks()}function toggleCredentialTypes(e=null){null===e||"strings-credentials-h3"===e.target.id?(document.getElementById("strings-credentials-h3").classList.add("fake-focus"),document.getElementById("strings-credentials-h4").classList.remove("fake-focus"),document.getElementById("temporary-credentials-div").hidden=!1,document.getElementById("long-lived-credentials-div").hidden=!0):(document.getElementById("strings-credentials-h3").classList.remove("fake-focus"),document.getElementById("strings-credentials-h4").classList.add("fake-focus"),document.getElementById("temporary-credentials-div").hidden=!0,document.getElementById("long-lived-credentials-div").hidden=!1)}checkForKey(),addEventListener("UI_DATA_UPDATE",debounceDisplayTemplateConfig),document.getElementById("region-select").addEventListener("change",updateRegion),document.getElementById("lang-select").addEventListener("change",setLanguage),document.getElementById("submit-credentials-button").addEventListener("click",addCredentials),document.getElementById("hide-errors").addEventListener("click",hideErrors),document.getElementById("hide-errors-button").addEventListener("click",hideErrors),document.getElementById("unlock-button").addEventListener("click",fetchConfigForKey),document.getElementById("enter-different-key").addEventListener("click",purgeConfig),document.getElementById("right-hand-menu-closed").addEventListener("click",openRightMenu),document.getElementById("install-a-kit-button").addEventListener("click",switchLeftMenuItem),document.getElementById("review-installed-button").addEventListener("click",switchLeftMenuItem),document.getElementById("switch-accounts-button").addEventListener("click",switchLeftMenuItem),document.getElementById("strings-credentials-h3").addEventListener("click",toggleCredentialTypes),document.getElementById("strings-credentials-h4").addEventListener("click",toggleCredentialTypes);